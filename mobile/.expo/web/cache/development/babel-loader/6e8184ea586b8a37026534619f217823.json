{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport * as React from 'react';\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport View from \"react-native-web/dist/exports/View\";\nimport { Button, Text } from 'react-native-paper';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { createClock, getUserStatus } from \"../../http/api\";\nimport { useAlert } from \"../../hooks/alert\";\nimport { ApplicationDate } from \"../../date/index\";\nimport { addNewCurrentUserClock } from \"../../stores/reducers/currentUserClocksReducer\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar CLockInOutForm = function CLockInOutForm() {\n  var dispatch = useDispatch();\n  var _React$useState = React.useState(null),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    timeIntervalRef = _React$useState2[0],\n    setTimeIntervalRef = _React$useState2[1];\n  var _useAlert = useAlert(),\n    alert = _useAlert.alert,\n    setAlert = _useAlert.setAlert,\n    Snackbar = _useAlert.component;\n  var currentUser = useSelector(function (state) {\n    return state.currentUser.value;\n  });\n  var status = useSelector(function (state) {\n    return state.currentUserStatus.value;\n  });\n  var _React$useState3 = React.useState(null),\n    _React$useState4 = _slicedToArray(_React$useState3, 2),\n    elapsedTimeSinceArrival = _React$useState4[0],\n    setElapsedTimeSinceArrival = _React$useState4[1];\n  React.useEffect(function () {\n    if (status && status.time && status.status && !timeIntervalRef) {\n      setTimeIntervalRef(setInterval(function () {\n        setElapsedTimeSinceArrival(ApplicationDate.calculateElapsedTimeSince(status.time));\n      }, 1000));\n    }\n    if (status && !status.status && timeIntervalRef) {\n      clearInterval(timeIntervalRef);\n      setTimeIntervalRef(null);\n      setElapsedTimeSinceArrival(null);\n    }\n  }, [status, timeIntervalRef]);\n  React.useEffect(function () {\n    return function () {\n      if (timeIntervalRef) {\n        clearInterval(timeIntervalRef);\n        setTimeIntervalRef(null);\n        setElapsedTimeSinceArrival(null);\n      }\n    };\n  }, []);\n  var handleCloseAlert = function handleCloseAlert() {\n    setAlert({\n      toggled: false,\n      message: \"\",\n      severity: \"error\"\n    });\n  };\n  var handleSubmit = function () {\n    var _ref = _asyncToGenerator(function* () {\n      var message = \"\";\n      var severity = \"error\";\n      try {\n        var _yield$createClock = yield createClock(currentUser.token, currentUser.user.id, {\n            clock: {\n              time: Math.floor(Date.now() / 1000)\n            }\n          }),\n          data = _yield$createClock.data;\n        dispatch(addNewCurrentUserClock(data));\n        setStatus(data);\n        message = data.status ? \"Arrival registered with success\" : \"Departure registered with success\";\n        severity = \"success\";\n      } catch (error) {\n        message = \"An unexpected error has been encountered, please try again later or contact tour administrator\";\n      } finally {\n        setAlert({\n          toggled: true,\n          message: message,\n          severity: severity\n        });\n      }\n    });\n    return function handleSubmit() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  return _jsx(ScrollView, {\n    contentContainerStyle: styles.scrollView,\n    children: _jsxs(View, {\n      style: styles.container,\n      children: [_jsx(Text, {\n        variant: \"bodyMedium\",\n        style: {\n          marginBottom: 16,\n          marginTop: 16\n        },\n        children: \"Press to clock in/out\"\n      }), _jsx(Button, {\n        buttonColor: status && status.status || !status ? \"#e91e63\" : \"#5393ff\",\n        mode: \"contained\",\n        onPress: handleSubmit,\n        style: styles.clockInOutButton,\n        children: _jsx(Text, {\n          variant: \"titleSmall\",\n          style: {\n            color: \"#FFF\"\n          },\n          children: elapsedTimeSinceArrival ? elapsedTimeSinceArrival.hours + \":\" + elapsedTimeSinceArrival.minutes + \":\" + elapsedTimeSinceArrival.seconds : \"Just arrived !\"\n        })\n      }), _jsx(Snackbar, {\n        onClose: handleCloseAlert,\n        toggled: alert.toggled,\n        message: alert.message,\n        severity: alert.severity\n      })]\n    })\n  });\n};\nvar styles = StyleSheet.create({\n  scrollView: {\n    height: \"100%\",\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\"\n  },\n  clockInOutButton: {\n    height: 180,\n    width: 180,\n    borderRadius: \"50%\",\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    shadowColor: '#000',\n    shadowOffset: {\n      width: 0,\n      height: 10\n    },\n    shadowOpacity: 0.2,\n    shadowRadius: 10\n  },\n  container: {\n    width: \"100%\",\n    height: \"100%\",\n    position: \"relative\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    flex: 1\n  },\n  elapsedTimeContainer: {\n    width: \"100%\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    marginBottom: 24\n  }\n});\nexport default CLockInOutForm;","map":{"version":3,"names":["React","Button","Text","useSelector","useDispatch","createClock","getUserStatus","useAlert","ApplicationDate","addNewCurrentUserClock","CLockInOutForm","dispatch","useState","timeIntervalRef","setTimeIntervalRef","alert","setAlert","Snackbar","component","currentUser","state","value","status","currentUserStatus","elapsedTimeSinceArrival","setElapsedTimeSinceArrival","useEffect","time","setInterval","calculateElapsedTimeSince","clearInterval","handleCloseAlert","toggled","message","severity","handleSubmit","token","user","id","clock","Math","floor","Date","now","data","setStatus","error","styles","scrollView","container","marginBottom","marginTop","clockInOutButton","color","hours","minutes","seconds","StyleSheet","create","height","display","alignItems","justifyContent","width","borderRadius","shadowColor","shadowOffset","shadowOpacity","shadowRadius","position","flex","elapsedTimeContainer"],"sources":["/Users/antoine/Documents/EPITECH/time-manager-/mobile/components/ClockInOutForm/index.js"],"sourcesContent":["import * as React from 'react';\nimport { ScrollView, StyleSheet, View } from 'react-native';\nimport { Button, Text } from 'react-native-paper';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { createClock, getUserStatus } from '../../http/api';\nimport { useAlert } from '../../hooks/alert';\nimport { ApplicationDate } from '../../date/index';\nimport { addNewCurrentUserClock } from '../../stores/reducers/currentUserClocksReducer';\n\nconst CLockInOutForm = () => {\n\n    const dispatch = useDispatch();\n    const [timeIntervalRef, setTimeIntervalRef] = React.useState(null)\n    const { alert, setAlert, component: Snackbar } = useAlert()\n    const currentUser = useSelector((state) => state.currentUser.value)\n    const status = useSelector((state) => state.currentUserStatus.value)\n\n    const [elapsedTimeSinceArrival, setElapsedTimeSinceArrival] = React.useState(null)\n\n\n    React.useEffect(() => {\n        if (status && status.time && status.status && !timeIntervalRef) {\n            setTimeIntervalRef(\n                setInterval(() => {\n                    setElapsedTimeSinceArrival(ApplicationDate.calculateElapsedTimeSince(status.time))\n                }, 1000)\n            )\n        }\n        if (status && !status.status && timeIntervalRef) {\n            clearInterval(timeIntervalRef)\n            setTimeIntervalRef(null)\n            setElapsedTimeSinceArrival(null)\n        }\n    }, [status, timeIntervalRef])\n\n\n    React.useEffect(() => () => {\n        if (timeIntervalRef) {\n            clearInterval(timeIntervalRef)\n            setTimeIntervalRef(null)\n            setElapsedTimeSinceArrival(null)\n        }\n    }, []);\n\n\n    const handleCloseAlert = () => {\n        setAlert({\n            toggled: false,\n            message: \"\",\n            severity: \"error\"\n        })\n    }\n\n    const handleSubmit = async () => {\n        let message = \"\";\n        let severity = \"error\"\n        try {\n            const { data } = await createClock(currentUser.token, currentUser.user.id, {\n                clock: {\n                    time: Math.floor(\n                        Date.now() / 1000\n                    )\n                }\n            })\n            dispatch(addNewCurrentUserClock(data))\n            setStatus(data)\n            message = data.status ? \"Arrival registered with success\" : \"Departure registered with success\";\n            severity = \"success\";\n        } catch (error) {\n            message = \"An unexpected error has been encountered, please try again later or contact tour administrator\"\n        } finally {\n            setAlert({\n                toggled: true,\n                message,\n                severity\n            })\n        }\n    }\n\n    return (\n\n        <ScrollView contentContainerStyle={styles.scrollView}>\n            <View style={styles.container}>\n\n                <Text variant=\"bodyMedium\" style={{ marginBottom: 16, marginTop: 16 }}>Press to clock in/out</Text>\n\n                <Button buttonColor={status && status.status || !status ? \"#e91e63\" : \"#5393ff\"} mode=\"contained\" onPress={handleSubmit} style={styles.clockInOutButton}>\n                    <Text variant=\"titleSmall\" style={{ color: \"#FFF\" }}>\n                        {elapsedTimeSinceArrival ? `${elapsedTimeSinceArrival.hours}:${elapsedTimeSinceArrival.minutes}:${elapsedTimeSinceArrival.seconds}` : \"Just arrived !\"}\n                    </Text>\n                </Button>\n\n                <Snackbar onClose={handleCloseAlert} toggled={alert.toggled} message={alert.message} severity={alert.severity} />\n            </View>\n        </ScrollView>\n\n    );\n};\n\nconst styles = StyleSheet.create({\n    scrollView: {\n        height: \"100%\",\n        display: \"flex\",\n        alignItems: \"center\",\n        justifyContent: \"center\",\n    },\n    clockInOutButton: {\n        height: 180,\n        width: 180,\n        borderRadius: \"50%\",\n        display: \"flex\",\n        alignItems: \"center\",\n        justifyContent: \"center\",\n        shadowColor: '#000',\n        shadowOffset: { width: 0, height: 10 },\n        shadowOpacity: 0.2,\n        shadowRadius: 10,\n    },\n    container: {\n        width: \"100%\",\n        height: \"100%\",\n        position: \"relative\",\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        flex: 1,\n    },\n    elapsedTimeContainer: {\n        width: \"100%\",\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        marginBottom: 24\n    }\n});\n\nexport default CLockInOutForm;"],"mappings":"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"},"metadata":{},"sourceType":"module"}