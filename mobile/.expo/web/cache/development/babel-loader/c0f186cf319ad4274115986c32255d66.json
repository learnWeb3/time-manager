{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport * as React from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport { Button, Text } from 'react-native-paper';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { validateEmail, validatePassword, validateRequired } from \"../../validators/index\";\nimport InputGroup from \"../InputGroup/index\";\nimport { useAlert } from \"../../hooks/alert\";\nimport { getProfileInformations, updateProfileInformations } from \"../../http/api\";\nimport { setCurrentUser } from \"../../stores/reducers/currentUserReducer\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nvar ProfileForm = function ProfileForm() {\n  var dispatch = useDispatch();\n  var currentUser = useSelector(function (state) {\n    return state.currentUser.value;\n  });\n  var _useAlert = useAlert(),\n    alert = _useAlert.alert,\n    setAlert = _useAlert.setAlert,\n    Snackbar = _useAlert.component;\n  var _React$useState = React.useState({\n      isError: true,\n      value: \"\",\n      errors: validateEmail(\"email\", \"\").errors\n    }),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    email = _React$useState2[0],\n    setEmail = _React$useState2[1];\n  var _React$useState3 = React.useState({\n      isError: true,\n      value: \"\",\n      errors: validateRequired(\"username\", \"\").errors\n    }),\n    _React$useState4 = _slicedToArray(_React$useState3, 2),\n    username = _React$useState4[0],\n    setUsername = _React$useState4[1];\n  var _React$useState5 = React.useState({\n      isError: true,\n      value: \"\",\n      errors: validatePassword(\"password\", \"\").errors\n    }),\n    _React$useState6 = _slicedToArray(_React$useState5, 2),\n    password = _React$useState6[0],\n    setPassword = _React$useState6[1];\n  React.useEffect(function () {\n    if (currentUser) {\n      setEmail({\n        errors: [],\n        isError: false,\n        value: currentUser.user.email\n      });\n      setUsername({\n        errors: [],\n        isError: false,\n        value: currentUser.user.username\n      });\n    }\n  }, [currentUser]);\n  var handleSubmit = function () {\n    var _ref = _asyncToGenerator(function* () {\n      var message = \"\";\n      var severity = \"error\";\n      var data = {\n        email: email.value,\n        password: password.value,\n        username: username.value\n      };\n      try {\n        if (currentUser) {\n          yield updateProfileInformations(currentUser.token, currentUser.user.id, data);\n          var updatedUser = yield getProfileInformations(currentUser.token, currentUser.user.id);\n          dispatch(setCurrentUser(updatedUser));\n          message = \"Profile updated with success\";\n          severity = \"success\";\n        } else {\n          throw new Error('current user must be set to perform authenticated http request');\n        }\n      } catch (error) {\n        message = \"An unexpected error has been encountered, please try again later or contact tour administrator\";\n      } finally {\n        setAlert({\n          toggled: true,\n          message: message,\n          severity: severity\n        });\n      }\n    });\n    return function handleSubmit() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  var handleEmail = function handleEmail(email) {\n    var _validateEmail = validateEmail(\"email\", email),\n      emailIsValid = _validateEmail.isValid,\n      emailValidationsErrors = _validateEmail.errors;\n    setEmail({\n      isError: !emailIsValid,\n      value: email,\n      errors: emailValidationsErrors\n    });\n  };\n  var handlePassword = function handlePassword(password) {\n    var _validatePassword = validatePassword(\"password\", password),\n      passwordIsValid = _validatePassword.isValid,\n      passwordValidationsErrors = _validatePassword.errors;\n    setPassword({\n      isError: !passwordIsValid,\n      value: password,\n      errors: passwordValidationsErrors\n    });\n  };\n  var handleUsername = function handleUsername(username) {\n    var _validateRequired = validateRequired(\"username\", username),\n      usernameIsValid = _validateRequired.isValid,\n      usernameValidationsErrors = _validateRequired.errors;\n    setUsername({\n      isError: !usernameIsValid,\n      value: username,\n      errors: usernameValidationsErrors\n    });\n  };\n  React.useEffect(function () {\n    console.log(username, password, email);\n  }, [username, password, email]);\n  var handleCloseAlert = function handleCloseAlert() {\n    setAlert({\n      toggled: false,\n      message: \"\",\n      severity: \"error\"\n    });\n  };\n  return _jsxs(_Fragment, {\n    children: [_jsxs(View, {\n      style: styles.container,\n      children: [_jsx(Text, {\n        style: styles.header,\n        variant: \"headlineMedium\",\n        children: \"User details\"\n      }), _jsx(InputGroup, {\n        label: \"Username\",\n        isError: username.isError,\n        errors: username.errors,\n        value: username.value,\n        handleInput: function handleInput(username) {\n          return handleUsername(username);\n        }\n      }), _jsx(InputGroup, {\n        label: \"Email\",\n        isError: email.isError,\n        errors: email.errors,\n        value: email.value,\n        handleInput: function handleInput(email) {\n          return handleEmail(email);\n        }\n      }), _jsx(InputGroup, {\n        label: \"Password\",\n        isError: password.isError,\n        errors: password.errors,\n        value: password.value,\n        handleInput: function handleInput(password) {\n          return handlePassword(password);\n        },\n        secureTextEntry: true\n      }), _jsx(Button, {\n        disabled: username.isError || email.isError || password.isError,\n        mode: \"contained\",\n        onPress: handleSubmit,\n        children: \"ok\"\n      })]\n    }), _jsx(Snackbar, {\n      onClose: handleCloseAlert,\n      toggled: alert.toggled,\n      message: alert.message,\n      severity: alert.severity\n    })]\n  });\n};\nvar styles = StyleSheet.create({\n  header: {\n    marginBottom: 24\n  },\n  container: {\n    width: \"100%\",\n    padding: 24\n  }\n});\nexport default ProfileForm;","map":{"version":3,"names":["React","Button","Text","useDispatch","useSelector","validateEmail","validatePassword","validateRequired","InputGroup","useAlert","getProfileInformations","updateProfileInformations","setCurrentUser","ProfileForm","dispatch","currentUser","state","value","alert","setAlert","Snackbar","component","useState","isError","errors","email","setEmail","username","setUsername","password","setPassword","useEffect","user","handleSubmit","message","severity","data","token","id","updatedUser","Error","error","toggled","handleEmail","emailIsValid","isValid","emailValidationsErrors","handlePassword","passwordIsValid","passwordValidationsErrors","handleUsername","usernameIsValid","usernameValidationsErrors","console","log","handleCloseAlert","styles","container","header","StyleSheet","create","marginBottom","width","padding"],"sources":["/Users/antoine/Documents/EPITECH/time-manager-/mobile/components/ProfileForm/index.js"],"sourcesContent":["import * as React from 'react';\nimport { View, StyleSheet } from 'react-native';\nimport { Button, Text } from 'react-native-paper';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { validateEmail, validatePassword, validateRequired } from '../../validators/index';\nimport InputGroup from '../InputGroup/index';\nimport { useAlert } from '../../hooks/alert';\nimport { getProfileInformations, updateProfileInformations } from '../../http/api';\nimport { setCurrentUser } from '../../stores/reducers/currentUserReducer';\n\nconst ProfileForm = () => {\n\n    const dispatch = useDispatch()\n    const currentUser = useSelector((state) => state.currentUser.value);\n    const { alert, setAlert, component: Snackbar } = useAlert()\n    const [email, setEmail] = React.useState({\n        isError: true,\n        value: \"\",\n        errors: validateEmail(\"email\", \"\").errors\n    })\n    const [username, setUsername] = React.useState({\n        isError: true,\n        value: \"\",\n        errors: validateRequired(\"username\", \"\").errors\n    })\n    const [password, setPassword] = React.useState({\n        isError: true,\n        value: \"\",\n        errors: validatePassword(\"password\", \"\").errors\n    })\n\n    React.useEffect(() => {\n        if (currentUser) {\n            setEmail({\n                errors: [],\n                isError: false,\n                value: currentUser.user.email\n            })\n\n            setUsername({\n                errors: [],\n                isError: false,\n                value: currentUser.user.username\n            })\n        }\n    }, [currentUser])\n\n    const handleSubmit = async () => {\n\n        let message = \"\";\n        let severity = \"error\"\n        const data = {\n            email: email.value,\n            password: password.value,\n            username: username.value\n        }\n\n        try {\n            if (currentUser) {\n                await updateProfileInformations(currentUser.token, currentUser.user.id, data)\n                const updatedUser = await getProfileInformations(currentUser.token, currentUser.user.id);\n                dispatch(\n                    setCurrentUser(\n                        updatedUser\n                    )\n                )\n                message = \"Profile updated with success\";\n                severity = \"success\";\n            } else {\n                throw new Error('current user must be set to perform authenticated http request')\n            }\n        } catch (error) {\n            message = \"An unexpected error has been encountered, please try again later or contact tour administrator\"\n        } finally {\n            setAlert({\n                toggled: true,\n                message,\n                severity\n            })\n        }\n    }\n\n    const handleEmail = (email) => {\n        const {\n            isValid: emailIsValid,\n            errors: emailValidationsErrors\n        } = validateEmail(\"email\", email)\n        setEmail({\n            isError: !emailIsValid,\n            value: email,\n            errors: emailValidationsErrors,\n        })\n    }\n\n\n    const handlePassword = (password) => {\n        const {\n            isValid: passwordIsValid,\n            errors: passwordValidationsErrors\n        } = validatePassword(\"password\", password)\n        setPassword({\n            isError: !passwordIsValid,\n            value: password,\n            errors: passwordValidationsErrors,\n        })\n    }\n\n    const handleUsername = (username) => {\n        const {\n            isValid: usernameIsValid,\n            errors: usernameValidationsErrors\n        } = validateRequired(\"username\", username)\n        setUsername({\n            isError: !usernameIsValid,\n            value: username,\n            errors: usernameValidationsErrors,\n        })\n    }\n\n    React.useEffect(() => {\n        console.log(username, password, email)\n    }, [username, password, email])\n\n\n    const handleCloseAlert = () => {\n        setAlert({\n            toggled: false,\n            message: \"\",\n            severity: \"error\"\n        })\n    }\n\n    return (\n        <>\n            <View style={styles.container}>\n                <Text style={styles.header} variant=\"headlineMedium\">User details</Text>\n\n                <InputGroup\n                    label={\"Username\"}\n                    isError={username.isError}\n                    errors={username.errors}\n                    value={username.value}\n                    handleInput={username => handleUsername(username)}\n                />\n\n                <InputGroup\n                    label={\"Email\"}\n                    isError={email.isError}\n                    errors={email.errors}\n                    value={email.value}\n                    handleInput={email => handleEmail(email)}\n                />\n\n                <InputGroup\n                    label={\"Password\"}\n                    isError={password.isError}\n                    errors={password.errors}\n                    value={password.value}\n                    handleInput={password => handlePassword(password)}\n                    secureTextEntry={true}\n                />\n\n                <Button disabled={username.isError || email.isError || password.isError} mode=\"contained\" onPress={handleSubmit}>\n                    ok\n                </Button>\n\n            </View>\n\n            <Snackbar onClose={handleCloseAlert} toggled={alert.toggled} message={alert.message} severity={alert.severity} />\n\n        </>\n    );\n};\n\nconst styles = StyleSheet.create({\n    header: {\n        marginBottom: 24\n    },\n    container: {\n        width: \"100%\",\n        padding: 24\n    },\n});\n\nexport default ProfileForm;"],"mappings":"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"},"metadata":{},"sourceType":"module"}