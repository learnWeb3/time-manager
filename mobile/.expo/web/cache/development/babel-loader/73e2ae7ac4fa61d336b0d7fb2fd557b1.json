{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport * as React from 'react';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport View from \"react-native-web/dist/exports/View\";\nimport { Avatar, Button, Text } from 'react-native-paper';\nimport { useSelector } from 'react-redux';\nimport { createClock, getUserStatus } from \"../../http/api\";\nimport { useAlert } from \"../../hooks/alert\";\nimport Logo from \"../Logo/index\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nvar toAbbreviateIconLabel = function toAbbreviateIconLabel() {\n  var string = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n  return string.slice(0, 2).toUpperCase();\n};\nvar CLockInOutForm = function CLockInOutForm() {\n  var _React$useState = React.useState(null),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    timeIntervalRef = _React$useState2[0],\n    setTimeIntervalRef = _React$useState2[1];\n  var _useAlert = useAlert(),\n    alert = _useAlert.alert,\n    setAlert = _useAlert.setAlert,\n    Snackbar = _useAlert.component;\n  var currentUser = useSelector(function (state) {\n    return state.currentUser.value;\n  });\n  var _React$useState3 = React.useState(null),\n    _React$useState4 = _slicedToArray(_React$useState3, 2),\n    status = _React$useState4[0],\n    setStatus = _React$useState4[1];\n  var _React$useState5 = React.useState(null),\n    _React$useState6 = _slicedToArray(_React$useState5, 2),\n    elapsedTimeSinceArrival = _React$useState6[0],\n    setElapsedTimeSinceArrival = _React$useState6[1];\n  React.useEffect(function () {\n    if (currentUser) {\n      getUserStatus(currentUser.token, currentUser.user.id).then(function (status) {\n        return setStatus(status.data ? status.data : \"no data\");\n      });\n    }\n  }, [currentUser]);\n  React.useEffect(function () {\n    if (status && status.time && status.status && !timeIntervalRef) {\n      setTimeIntervalRef(setInterval(function () {\n        setElapsedTimeSinceArrival(calculateElapsedTimeSinceArrival(status.time));\n      }, 1000));\n    }\n    if (status && !status.status && timeIntervalRef) {\n      clearInterval(timeIntervalRef);\n      setTimeIntervalRef(null);\n      setElapsedTimeSinceArrival(null);\n    }\n  }, [status, timeIntervalRef]);\n  React.useEffect(function () {\n    return function () {\n      if (timeIntervalRef) {\n        clearInterval(timeIntervalRef);\n        setTimeIntervalRef(null);\n        setElapsedTimeSinceArrival(null);\n      }\n    };\n  }, []);\n  var handleCloseAlert = function handleCloseAlert() {\n    setAlert({\n      toggled: false,\n      message: \"\",\n      severity: \"error\"\n    });\n  };\n  var handleSubmit = function () {\n    var _ref = _asyncToGenerator(function* () {\n      var message = \"\";\n      var severity = \"error\";\n      try {\n        var _yield$createClock = yield createClock(currentUser.token, currentUser.user.id),\n          data = _yield$createClock.data;\n        setStatus(data);\n        message = data.status ? \"Arrival registered with success\" : \"Departure registered with success\";\n        severity = \"success\";\n      } catch (error) {\n        message = \"An unexpected error has been encountered, please try again later or contact tour administrator\";\n      } finally {\n        setAlert({\n          toggled: true,\n          message: message,\n          severity: severity\n        });\n      }\n    });\n    return function handleSubmit() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  var calculateElapsedTimeSinceArrival = function calculateElapsedTimeSinceArrival(arrivalTimeSeconds) {\n    var elapsedTimeSeconds = Math.round(Date.now() / 1000) - arrivalTimeSeconds;\n    var hours = Math.floor(elapsedTimeSeconds / 3600);\n    var minutes = Math.floor((elapsedTimeSeconds - hours * 3600) / 60);\n    var seconds = Math.floor(elapsedTimeSeconds - (hours * 3600 + minutes * 60));\n    return {\n      hours: hours,\n      minutes: minutes,\n      seconds: seconds\n    };\n  };\n  return _jsxs(_Fragment, {\n    children: [_jsxs(View, {\n      style: styles.container,\n      children: [_jsx(Logo, {\n        style: {\n          position: \"absolute\",\n          top: 0,\n          height: 100,\n          width: \"100%\"\n        }\n      }), _jsx(View, {\n        style: styles.headerContainer,\n        children: _jsx(Text, {\n          style: {\n            fontWeight: 900\n          },\n          variant: \"headlineMedium\",\n          children: \"Welcome !\"\n        })\n      }), _jsxs(View, {\n        style: styles.avatarContainer,\n        children: [_jsx(Avatar.Text, {\n          style: {\n            marginBottom: 16\n          },\n          size: 160,\n          label: toAbbreviateIconLabel(currentUser ? currentUser.user.email : \"\")\n        }), _jsx(Text, {\n          style: {\n            fontWeight: 900\n          },\n          variant: \"titleMedium\",\n          children: currentUser.user.username\n        })]\n      }), elapsedTimeSinceArrival && _jsx(View, {\n        style: styles.elapsedTimeContainer,\n        children: _jsxs(Text, {\n          variant: \"headlineMedium\",\n          children: [elapsedTimeSinceArrival.hours, \":\", elapsedTimeSinceArrival.minutes, \":\", elapsedTimeSinceArrival.seconds]\n        })\n      }), status && _jsx(Button, {\n        buttonColor: \"green\",\n        icon: \"clock\",\n        mode: \"contained\",\n        onPress: handleSubmit,\n        children: !status.status ? \"Just arrived !\" : \"Going back home !\"\n      })]\n    }), _jsx(Snackbar, {\n      onClose: handleCloseAlert,\n      toggled: alert.toggled,\n      message: alert.message,\n      severity: alert.severity\n    })]\n  });\n};\nvar styles = StyleSheet.create({\n  headerContainer: {\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginBottom: 24\n  },\n  container: {\n    width: \"100%\",\n    position: \"relative\"\n  },\n  avatarContainer: {\n    width: \"100%\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    marginBottom: 24\n  },\n  elapsedTimeContainer: {\n    width: \"100%\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    marginBottom: 24\n  }\n});\nexport default CLockInOutForm;","map":{"version":3,"names":["React","Avatar","Button","Text","useSelector","createClock","getUserStatus","useAlert","Logo","toAbbreviateIconLabel","string","slice","toUpperCase","CLockInOutForm","useState","timeIntervalRef","setTimeIntervalRef","alert","setAlert","Snackbar","component","currentUser","state","value","status","setStatus","elapsedTimeSinceArrival","setElapsedTimeSinceArrival","useEffect","token","user","id","then","data","time","setInterval","calculateElapsedTimeSinceArrival","clearInterval","handleCloseAlert","toggled","message","severity","handleSubmit","error","arrivalTimeSeconds","elapsedTimeSeconds","Math","round","Date","now","hours","floor","minutes","seconds","styles","container","position","top","height","width","headerContainer","fontWeight","avatarContainer","marginBottom","email","username","elapsedTimeContainer","StyleSheet","create","alignItems","justifyContent"],"sources":["/Users/antoine/Documents/EPITECH/time-manager-/mobile/components/ClockInOutForm/index.js"],"sourcesContent":["import * as React from 'react';\nimport { StyleSheet, View } from 'react-native';\nimport { Avatar, Button, Text } from 'react-native-paper';\nimport { useSelector } from 'react-redux';\nimport { createClock, getUserStatus } from '../../http/api';\nimport { useAlert } from '../../hooks/alert';\nimport Logo from '../Logo/index';\n\nconst toAbbreviateIconLabel = (string = \"\") => string.slice(0, 2).toUpperCase()\n\nconst CLockInOutForm = () => {\n\n\n    const [timeIntervalRef, setTimeIntervalRef] = React.useState(null)\n    const { alert, setAlert, component: Snackbar } = useAlert()\n    const currentUser = useSelector((state) => state.currentUser.value)\n\n    const [status, setStatus] = React.useState(null)\n    const [elapsedTimeSinceArrival, setElapsedTimeSinceArrival] = React.useState(null)\n\n    React.useEffect(() => {\n        if (currentUser) {\n            getUserStatus(currentUser.token, currentUser.user.id).then((status) => setStatus(status.data ? status.data : \"no data\"))\n        }\n    }, [currentUser])\n\n\n    React.useEffect(() => {\n        if (status && status.time && status.status && !timeIntervalRef) {\n            setTimeIntervalRef(\n                setInterval(() => {\n                    setElapsedTimeSinceArrival(calculateElapsedTimeSinceArrival(status.time))\n                }, 1000)\n            )\n        }\n        if (status && !status.status && timeIntervalRef) {\n            clearInterval(timeIntervalRef)\n            setTimeIntervalRef(null)\n            setElapsedTimeSinceArrival(null)\n        }\n    }, [status, timeIntervalRef])\n\n\n    React.useEffect(() => () => {\n        if (timeIntervalRef) {\n            clearInterval(timeIntervalRef)\n            setTimeIntervalRef(null)\n            setElapsedTimeSinceArrival(null)\n        }\n    }, []);\n\n\n    const handleCloseAlert = () => {\n        setAlert({\n            toggled: false,\n            message: \"\",\n            severity: \"error\"\n        })\n    }\n\n    const handleSubmit = async () => {\n        let message = \"\";\n        let severity = \"error\"\n        try {\n            const { data } = await createClock(currentUser.token, currentUser.user.id)\n            setStatus(data)\n            message = data.status ? \"Arrival registered with success\" : \"Departure registered with success\";\n            severity = \"success\";\n        } catch (error) {\n            message = \"An unexpected error has been encountered, please try again later or contact tour administrator\"\n        } finally {\n            setAlert({\n                toggled: true,\n                message,\n                severity\n            })\n        }\n    }\n\n    const calculateElapsedTimeSinceArrival = (arrivalTimeSeconds) => {\n        const elapsedTimeSeconds = Math.round(Date.now() / 1000) - arrivalTimeSeconds\n        const hours = Math.floor(elapsedTimeSeconds / 3600)\n        const minutes = Math.floor((elapsedTimeSeconds - (hours * 3600)) / 60)\n        const seconds = Math.floor(elapsedTimeSeconds - ((hours * 3600) + (minutes * 60)))\n        return {\n            hours,\n            minutes,\n            seconds\n        }\n    }\n\n    return (\n        <>\n            <View style={styles.container}>\n                <Logo style={{ position: \"absolute\", top:0, height: 100, width: \"100%\" }} />\n                <View style={styles.headerContainer}>\n                    <Text style={{ fontWeight: 900 }} variant=\"headlineMedium\">Welcome !</Text>\n                </View>\n                <View style={styles.avatarContainer}>\n                    <Avatar.Text style={{ marginBottom: 16 }} size={160} label={\n                        toAbbreviateIconLabel(currentUser ? currentUser.user.email : \"\")\n                    } />\n                    <Text style={{ fontWeight: 900 }} variant=\"titleMedium\">{currentUser.user.username}</Text>\n                </View>\n\n                {elapsedTimeSinceArrival && <View style={styles.elapsedTimeContainer}>\n                    <Text variant=\"headlineMedium\">\n                        {elapsedTimeSinceArrival.hours}:\n                        {elapsedTimeSinceArrival.minutes}:\n                        {elapsedTimeSinceArrival.seconds}\n                    </Text>\n                </View>}\n\n                {status && <Button buttonColor='green' icon=\"clock\" mode=\"contained\" onPress={handleSubmit}>\n                    {!status.status ? \"Just arrived !\" : \"Going back home !\"}\n                </Button>}\n            </View>\n            <Snackbar onClose={handleCloseAlert} toggled={alert.toggled} message={alert.message} severity={alert.severity} />\n        </>\n    );\n};\n\nconst styles = StyleSheet.create({\n    headerContainer: {\n        alignItems: \"center\",\n        justifyContent: \"center\",\n        marginBottom: 24\n    },\n    container: {\n        width: \"100%\",\n        position: \"relative\"\n    },\n    avatarContainer: {\n        width: \"100%\",\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        marginBottom: 24\n    },\n    elapsedTimeContainer: {\n        width: \"100%\",\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        marginBottom: 24\n    }\n});\n\nexport default CLockInOutForm;"],"mappings":"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"},"metadata":{},"sourceType":"module"}